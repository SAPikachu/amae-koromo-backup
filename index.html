<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>雀魂牌谱屋</title>
  <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <style type="text/css">
    body {
      background: url(data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAA8AAD/4QMZaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjMtYzAxMSA2Ni4xNDU2NjEsIDIwMTIvMDIvMDYtMTQ6NTY6MjcgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQ2NUQ4MzQ3QzZFNzExRTlBREZCQjk0NEUyQUI3MTA1IiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQ2NUQ4MzQ2QzZFNzExRTlBREZCQjk0NEUyQUI3MTA1IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzYgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSIyRTAzM0NEMDI1Mjg1REUyNTczRjRCRjc4ODkzQjFBRiIgc3RSZWY6ZG9jdW1lbnRJRD0iMkUwMzNDRDAyNTI4NURFMjU3M0Y0QkY3ODg5M0IxQUYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7/7gAOQWRvYmUAZMAAAAAB/9sAhAAGBAQEBQQGBQUGCQYFBgkLCAYGCAsMCgoLCgoMEAwMDAwMDBAM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);
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-attachment: fixed;
    }
  </style>
</head>
<body>

<script src="deps.js"></script>

<div id="root"></div>

<script type="module">
  const html = htm.bind(React.createElement);
  
  const { useEffect, useState } = React; 
  
  const DATA_ROOT = "https://d2ek5tscv4zquv.cloudfront.net/";
  const RANK_LABELS = ["初", "士", "杰", "豪", "圣", "魂"];
  const MODE_LABELS = {
    16: "王座",
    12: "玉",
  };
  const MODE_CHECKBOXES = Object.entries(MODE_LABELS).map(([key, label]) => ({
    key,
    label,
  }));
  
  function fetchGameRecords(date) {
    const dateString = moment(date).format("YYMMDD");
    const isToday = moment(date).isSame(moment(), "day");
    const cacheTag = `gameRecord${isToday ? "Today" : dateString}`;
    if (isToday && (!sessionStorage.lastUpdateTimestamp || (new Date()).getTime() > parseInt(sessionStorage.lastUpdateTimestamp) + 120000)) {
      sessionStorage.removeItem(cacheTag);
      sessionStorage.setItem("lastUpdateTimestamp", (new Date()).getTime());
    }
    if (sessionStorage[cacheTag]) {
      return Promise.resolve(JSON.parse(sessionStorage[cacheTag]));
    }
    return fetch(`${DATA_ROOT}records/${dateString}.json?t=${cacheTag}`).then(resp => resp.json()).then(x => {
      try {
        sessionStorage.setItem(cacheTag, JSON.stringify(x));
      } catch (e) {
        sessionStorage.clear();
        sessionStorage.setItem(cacheTag, JSON.stringify(x));
      }
      return x;
    }).catch(() => ({}));
  }
  function getLevelTag(levelId) {
    const realId = levelId % 10000;
    const majorRank = Math.floor(realId / 100);
    const minorRank = realId % 100;
    const label = RANK_LABELS[majorRank - 1];
    if (majorRank === RANK_LABELS.length) {
      return label;
    }
    return label + minorRank;
  }
  const Container = ({title, children, fluid = false}) => html`
<div class="container${fluid ? "-fluid" : ""} my-5">
  <div class="row">
    <div class="col-sm-12">
      ${title && html`<h2 class="mb-4">${title}</h2>`}
      ${children}
    </div>
  </div>
</div>
`;
  const FormRow = ({title = "", children}) => html`
<div class="form-group row">
  <label class="col-sm-2 col-form-label">${title}</label>
  <div class="col-sm-10">
    ${children}
  </div>
</div>
`;
  function Table({headers, children}) {
    if (typeof headers === "string") {
      headers = headers.split(",");
    }
    return html`
<table class="table table-striped">
  ${ headers && html`<thead class="text-nowrap">${headers.map((x) => html`<th key="${x}">${x}</th>`)}</thead>`}
  <tbody>
    ${children}
  </tbody>
</table>
`;
  }
  function SteppingListRenderer ({batchSize = 50, renderInterval = 100, children}) {
    const [numItems, setNumItems] = useState(0);
    useEffect(() => {
      let timeoutToken = null;
      if (children && children.length) {
        let numItems = 0;
        const count = children.length;
        const step = () => {
          timeoutToken = null;
          numItems += batchSize;
          numItems = Math.min(count, numItems);
          setNumItems(numItems);
          if (numItems < count) {
            timeoutToken = setTimeout(step, renderInterval);
          }
        };
        step();
      }
      return () => {
        if (timeoutToken) {
          clearTimeout(timeoutToken);
        }
      };
    }, [children]);
    if (!children || !children.length) {
      return html`<${React.Fragment}>${children}<//>`
    }
    return html`<${React.Fragment}>${children.slice(0, numItems)}<//>`;
  }
  function CheckboxGroup({ items = [], checkedItems = [], groupKey = "default", onChange = (selectedItems) => {} }) {
    const [selectedItemKeys, setSelectedItemKeys] = useState(() => new Set(checkedItems.map(x => x.key)));
    const setSelected = function(key, isSelected) {
      if (isSelected && selectedItemKeys.has(key)) {
        return;
      }
      if (!isSelected && !selectedItemKeys.has(key)) {
        return;
      }
      const newSet = new Set(selectedItemKeys);
      if (isSelected) {
        newSet.add(key);
      } else {
        newSet.delete(key);
      }
      setSelectedItemKeys(newSet);
      onChange(items.filter(x => newSet.has(x.key)));
    };
    return html`
<${React.Fragment}>
  ${items.map(item => html`
    <div class="form-check form-check-inline" key="${item.key}">
      <input class="form-check-input" type="checkbox" id="CG_${groupKey}_${item.key}" value="${item.key}" checked="${selectedItemKeys.has(item.key)}" onChange="${(event) => setSelected(item.key, event.target.checked)}" />
      <label class="form-check-label" for="CG_${groupKey}_${item.key}">${item.label}</label>
    </div>
  `)}
<//>
`;
  }
  function Alert({ className = "", type = "info", container = React.Fragment, stateName, children }) {
    const stateKey = `alertState_${stateName}`;
    const [closed, setClosed] = useState(() => stateName && !!localStorage.getItem(stateKey));
    useEffect(() => {
      if (stateName && closed) {
        localStorage.setItem(stateKey, true);
      }
    }, [closed]);
    if (closed) {
      return null;
    }
    const Cont = container;
    return html`
<${Cont}>
  <div class="alert alert-${type} alert-dismissible fade show ${className}" role="alert">
    ${children}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close" onClick=${(event) => { event.preventDefault(); setClosed(true); }}>
      <span aria-hidden="true">×</span>
    </button>
  </div>
<//>
`;
  }
  function DatePicker({
    initialDate = new Date(),
    onChange = (date) => {},
    className = "",
    min, max = moment(),
  }) {
    const [date, setDate] = useState(initialDate);
    const handleChange = function(event) {
      const newDate = moment(event.target.value, "YYYY-MM-DD").toDate();
      setDate(newDate);
      onChange(newDate);
    };
    return html`<input class="${className}" type="date" value=${moment(date).format("YYYY-MM-DD")} min=${min ? moment(min).format("YYYY-MM-DD") : undefined} max=${max ? moment(max).format("YYYY-MM-DD") : undefined} onChange=${handleChange}/>`;
  }
  function Player({ player: { nickname, level, score }, isTop }) {
    return html`<div class="player ${isTop && "font-weight-bold"}">[${getLevelTag(level)}] ${nickname} ${score !== undefined && `[${score}]`}</div>`;
  }
  function GameRecordRow({ game }) {
    const topScore = Math.max(...game.players.map(x => x.score));
    return html`
<tr>
  <td>${MODE_LABELS[game.modeId]}</td>
  <td>
    <div class="row no-gutters">
      ${game.players.map(x => html`<div key="{x.accountId}" class="col-6 pr-1"><${Player} player=${x} isTop=${x.score === topScore} /></div>`)}
    </div>
  </td>
  <td>${moment.unix(game.startTime).format("HH:mm")}</td>
  <td>${moment.unix(game.endTime).format("HH:mm")}</td>
  <td><a href="https://www.majsoul.com/1/?paipu=${game.uuid}" class="text-nowrap" target="_blank">牌谱</a></td>
</tr>`
  }
  function GameRecords({ initialDate = new Date() }) {
    const [loading, setLoading] = useState(true);
    const [data, setData] = useState([]);
    const [pendingData, setPendingData] = useState(null);
    const [date, setDate] = useState(initialDate);
    const [searchText, setSearchText] = useState("");
    const [selectedModes, setSelectedModes] = useState(() => new Set(MODE_CHECKBOXES.map(x => x.key)));
    if (pendingData) {
      if (pendingData.date === date) {
        setData(pendingData.data);
        setLoading(false);
      }
      setPendingData(null);
    }
    useEffect(() => {
      setData([]);
      setLoading(true);
      const curDate = date;
      fetchGameRecords(date).then(x => {
        const ret = Object.values(x);
        ret.sort((a, b) => b.endTime - a.endTime);
        return ret;
      }).then(x => setPendingData({ data: x, date: curDate }));
    }, [date]);
    const filteredData = data.filter((x) => {
      if (!selectedModes.has(x.modeId.toString())) {
        return false;
      }
      if (searchText && !x.players.some(player => player.nickname.toLowerCase().indexOf(searchText.trim().toLowerCase()) > -1)) {
        return false;
      }
      return true;
    });
    return html`
      <${FormRow} title="日期">
        <${DatePicker} min=${moment("2019-08-23", "YYYY-MM-DD")} className="form-control" initialDate=${initialDate} onChange=${(x) => setDate(x)}/>
      <//>
      <${FormRow} title="查找玩家">
        <input type="text" className="form-control" value=${searchText} onChange=${(event) => setSearchText(event.target.value)}/>
      <//>
      <${FormRow}>
        <${CheckboxGroup} items=${MODE_CHECKBOXES} checkedItems=${MODE_CHECKBOXES} onChange=${selected => setSelectedModes(new Set(selected.map(x => x.key)))}/>
      <//>
      <${Table} headers="等级,玩家,开始,结束,">
        <${SteppingListRenderer}>
          ${filteredData.map(x => html`<${GameRecordRow} key=${x.uuid} game=${x}/>`)}
        <//>
      <//>
      ${loading && html`<p class="text-center">加载中...</p>`}
`;
  }
  function App() {
    return html`
<${Container}>
  <h1>雀魂牌谱屋</h1>
<//>
<${Alert} container=${Container} stateName="topNote">
  <h4>说明</h4>
  <ul>
    <li>本页面由第三方维护，与雀魂官方无关</li>
    <li>记录包含雀魂国服四人半庄段位战玉之间及王座之间的牌谱</li>
    <li>正常情况下全部对局都会被记录，但不排除因网络问题遗漏部分对局的情况</li>
    <li>页面不是实时更新，一般对局会在结束后二十分钟内出现</li>
    <li>如有问题或建议，请戳 <a href="mailto:i@sapika.ch">SAPikachu (i@sapika.ch)</a> 或 <a href="https://github.com/SAPikachu/amae-koromo/">提交 Issue</a></li>
  </ul>
<//>
<${Container}>
  <${GameRecords}/>
<//>

`;
  }
  ReactDOM.render(html`<${App}/>`, document.getElementById("root"));
</script>
  
</body>
</html>
